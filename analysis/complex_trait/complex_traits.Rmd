```{r}
library(ggplot2)
library(vroom)
```

## Looking at mash significant hits
```{r}
bmi_ldsc_mash <- vroom("results/ldsc/baseline_omit_eqtl_gtex_mash-signif_annot.BMI.results")
```

Where do we see the most enrichment?
```{r fig.height=5, fig.width=6}
bmi_ldsc_mash_qtls <- filter(bmi_ldsc_mash, str_sub(Category, 1, 4)=="Omit")  %>%
  mutate(Category=str_sub(Category, 6, -5)) %>%
  mutate(highlight=(Category == "EB"))

dec_enrich_bmi_mash <- arrange(bmi_ldsc_mash_qtls, Enrichment, decreasing=T) %>% pull(Category)

ggplot(bmi_ldsc_mash_qtls, aes(x=factor(Category, levels=dec_enrich_bmi_mash), y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Enrichment of QTL Sets") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```

```{r fig.height=5, fig.width=6}
dec_h2_bmi_mash <- arrange(bmi_ldsc_mash_qtls, Prop._h2, decreasing=T) %>% pull(Category)

ggplot(bmi_ldsc_mash_qtls, aes(x=factor(Category, levels=dec_h2_bmi_mash), y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2_std_error, ymax = Prop._h2 + Prop._h2_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Proportion of Heritability Explained") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```

## Without mash
```{r}
bmi_ldsc <- vroom("results/ldsc/baseline_omit_eqtl_gtex_signif_annot.BMI.results")

```

```{r fig.height=5, fig.width=6}
bmi_ldsc_qtls <- filter(bmi_ldsc, str_sub(Category, 1, 4)=="Omit")  %>%
  mutate(Category=str_sub(Category, 6, -5)) %>%
  mutate(highlight=(Category == "EB"))

ggplot(bmi_ldsc_qtls, aes(x=Category, y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Enrichment of QTL Sets") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```
```{r fig.height=5, fig.width=6}
ggplot(bmi_ldsc_qtls, aes(x=Category, y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2_std_error, ymax = Prop._h2 + Prop._h2_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Proportion of Heritability Explained") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```

## Schizophrenia
```{r}
scz_ldsc <- vroom("results/ldsc/baseline_omit_eqtl_gtex_signif_annot.SCZ.results")
```

```{r fig.height=5, fig.width=6}
scz_ldsc_qtls <- filter(scz_ldsc, str_sub(Category, 1, 4)=="Omit")  %>%
  mutate(Category=str_sub(Category, 6, -5)) %>%
  mutate(highlight=(Category == "EB"))
dec_enrich_scz <- arrange(scz_ldsc_qtls, Enrichment, decreasing=T) %>% pull(Category)

ggplot(scz_ldsc_qtls, aes(x=factor(Category, levels=dec_enrich_scz), y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Enrichment of QTL Sets") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```

```{r fig.height=5, fig.width=6}
dec_h2_scz <- arrange(scz_ldsc_qtls, Prop._h2, decreasing=T) %>% pull(Category)
ggplot(scz_ldsc_qtls, aes(x=factor(Category, levels=dec_h2_scz), y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2_std_error, ymax = Prop._h2 + Prop._h2_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Omitted Tissue",
       y = "Proportion of Heritability Explained") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```

Now, just as a sanity check, if we look at enrichment in a regular (not leave-one-out) analysis, 
do we see the expected trends of brain being at the top? No
```{r fig.height=5, fig.width=6}
scz_ldsc_noomit <- vroom("results/ldsc/baseline_eqtl_gtex_signif_annot.SCZ.results")

scz_ldsc_noomit_qtls <- slice_tail(scz_ldsc_noomit, n=50)  %>%
  mutate(Category=str_sub(Category, 1, -5)) %>%
  mutate(highlight=(Category == "EB"))
dec_enrich_noomit_scz <- arrange(scz_ldsc_noomit_qtls, Enrichment, decreasing=T) %>% pull(Category)

ggplot(scz_ldsc_noomit_qtls, aes(x=factor(Category, levels=dec_enrich_noomit_scz), y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Tissue",
       y = "Enrichment of QTL Sets") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```

```{r fig.height=5, fig.width=6}
dec_h2_noomit_scz <- arrange(scz_ldsc_noomit_qtls, Prop._h2, decreasing=T) %>% pull(Category)

ggplot(scz_ldsc_noomit_qtls, aes(x=factor(Category, levels=dec_h2_noomit_scz), y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2_std_error, ymax = Prop._h2 + Prop._h2_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Tissue",
       y = "Proportion of Heritability Explained") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```

How about the coefficients (after controlling for all other groups)
```{r fig.height=5, fig.width=6}
dec_tau_noomit_scz <- arrange(scz_ldsc_noomit_qtls, Coefficient, decreasing=T) %>% pull(Category)

ggplot(scz_ldsc_noomit_qtls, aes(x=factor(Category, levels=dec_tau_noomit_scz), y=Coefficient, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Coefficient - Coefficient_std_error, ymax = Coefficient + Coefficient_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Tissue",
       y = "Proportion of Heritability Explained") +
  theme_classic(base_size=20) +
  theme(legend.position = "none") +
  coord_flip()
```


How many eQTLs are we seeing per tissue?
```{r fig.height=4, fig.width=6}
baseline_annot <- vroom(paste0("data/ldsc/baseline_eqtl_gtex_signif_annot/baselineLD.", seq(1, 22), ".annot.gz"))
qtls_annot <- baseline_annot %>%
  select((ncol(.) - 49):ncol(.))

n_qtls <- as_tibble(colSums(qtls_annot), rownames="Tissue") 

ggplot(n_qtls, aes(x=Tissue, y=value)) +
  geom_bar(stat="identity") +
  theme_classic(base_size=20) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```

What about with mash?
How many eQTLs are we seeing per tissue?
```{r fig.height=4, fig.width=6}
baseline_annot_mash <- vroom(paste0("data/ldsc/baseline_eqtl_gtex_mash-signif_annot/baselineLD.", seq(1, 22), ".annot.gz"))
qtls_annot_mash <- baseline_annot_mash %>%
  select((ncol(.) - 49):ncol(.))

n_qtls_mash <- as_tibble(colSums(qtls_annot_mash), rownames="Tissue") 

ggplot(n_qtls_mash, aes(x=Tissue, y=value)) +
  geom_bar(stat="identity") +
  theme_classic(base_size=20) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```

## Combining GTEx like EBs
```{r}
baseline_annot_gtexcomb <- vroom(paste0("data/ldsc/baseline_eqtl_gtexcomb_signif_annot/baselineLD.", seq(1, 22), ".annot.gz"))
qtls_annot_gtexcomb <- baseline_annot_gtexcomb %>%
  select((ncol(.) - 1):ncol(.))

n_qtls_gtexcomb <- as_tibble(colSums(qtls_annot_gtexcomb), rownames="Dataset") 

ggplot(n_qtls_gtexcomb, aes(x=Dataset, y=value)) +
  geom_bar(stat="identity") +
  theme_classic(base_size=20) +
  theme(axis.text.x = element_text(angle = 45, hjust=1))
```

How do the EB eQTLs compare to GTEx eQTLs?
```{r}
scz_ldsc_gtexcomb <- vroom("results/ldsc/baseline_eqtl_gtexcomb_signif_annot.SCZ.results")

scz_ldsc_qtls_gtexcomb <- scz_ldsc_gtexcomb %>%
  slice_tail(n=2)  %>%
  mutate(Category=str_sub(Category, 1, -5)) %>%
  mutate(highlight=(Category == "EB"))

ggplot(scz_ldsc_qtls_gtexcomb, aes(x=Category, y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Heritability Enrichment") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(scz_ldsc_qtls_gtexcomb, aes(x=Category, y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2, ymax = Prop._h2 + Prop._h2), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Heritability Explained") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(scz_ldsc_qtls_gtexcomb, aes(x=Category, y=Coefficient, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Coefficient - Coefficient_std_error, ymax = Coefficient + Coefficient_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Coefficient") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```

How about our mash eQTLs? 
```{r}
scz_ldsc_gtexcomb_mash <- vroom("results/ldsc/baseline_eqtl_gtexcomb_mash-signif_annot.SCZ.results")

scz_ldsc_qtls_gtexcomb_mash <- scz_ldsc_gtexcomb_mash %>%
  slice_tail(n=2)  %>%
  mutate(Category=str_sub(Category, 1, -5)) %>%
  mutate(highlight=(Category == "EB"))

ggplot(scz_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Heritability Enrichment") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(scz_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2, ymax = Prop._h2 + Prop._h2), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Heritability Explained") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(scz_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Coefficient, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Coefficient - Coefficient_std_error, ymax = Coefficient + Coefficient_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "SCZ Coefficient") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```
## CVD
```{r}
cvd_ldsc_gtexcomb <- vroom("results/ldsc/baseline_eqtl_gtexcomb_signif_annot.CVD.results")
```

```{r}
cvd_ldsc_qtls_gtexcomb <- cvd_ldsc_gtexcomb %>%
  slice_tail(n=2)  %>%
  mutate(Category=str_sub(Category, 1, -5)) %>%
  mutate(highlight=(Category == "EB"))

ggplot(cvd_ldsc_qtls_gtexcomb, aes(x=Category, y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Heritability Enrichment") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(cvd_ldsc_qtls_gtexcomb, aes(x=Category, y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2, ymax = Prop._h2 + Prop._h2), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Heritability Explained") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(cvd_ldsc_qtls_gtexcomb, aes(x=Category, y=Coefficient, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Coefficient - Coefficient_std_error, ymax = Coefficient + Coefficient_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Coefficient") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```

```{r}
cvd_ldsc_gtexcomb_mash <- vroom("results/ldsc/baseline_eqtl_gtexcomb_mash-signif_annot.CVD.results")
```

```{r}
cvd_ldsc_qtls_gtexcomb_mash <- cvd_ldsc_gtexcomb_mash %>%
  slice_tail(n=2)  %>%
  mutate(Category=str_sub(Category, 1, -5)) %>%
  mutate(highlight=(Category == "EB"))

ggplot(cvd_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Enrichment, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Enrichment - Enrichment_std_error, ymax = Enrichment + Enrichment_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Heritability Enrichment") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(cvd_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Prop._h2, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Prop._h2 - Prop._h2, ymax = Prop._h2 + Prop._h2), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Heritability Explained") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()

ggplot(cvd_ldsc_qtls_gtexcomb_mash, aes(x=Category, y=Coefficient, fill=highlight)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = Coefficient - Coefficient_std_error, ymax = Coefficient + Coefficient_std_error), position = position_dodge(width = 0.9), width = 0.25) +
  scale_fill_manual(values=c("#BBBBBB", "#B51700")) +
  labs(x = "Dataset",
       y = "CVD Coefficient") +
  theme_classic(base_size=12) +
  theme(legend.position = "none") +
  coord_flip()
```